<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco Map: Explore our Trees in Bukidnon</title>

    <!-- Leaflet  -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>


     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">   
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
   <style>
        #map {
            height: 570px;
            width: 100%;
        }

        .popup-image {
            max-width: 200px;
            height: auto;
        }

        /* Simple search bar (NO external CSS) */
        #search-container {
            width: 100%;
            text-align: center;
            margin: 10px 0;
        }

        #searchBar {
            padding: 7px 13px;
            width: 260px;
            font-size: 16px;
            border: 1px solid #aaa;
            border-radius: 6px;
        }
    </style>
</head>

<body>
    <h1>Eco Map</h1>

    <div id="search-container">
        <input type="text" id="searchBar" placeholder="Search for tree species...">
    </div>

    <div id="map"></div>

    <script>
        function initMap(mapDataUrl) {

            const map = L.map('map').setView([8.2, 125.1], 9);

            //Ang base layer
            const openStreetMap = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            const satellite = L.tileLayer(
                'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
                { attribution: 'Tiles Â© Esri | Maxar | Earthstar Geographics' }
            );

            openStreetMap.addTo(map);

            let markers = []; //i store ang marker kada search

            fetch(mapDataUrl)
                .then(res => res.json())
                .then(data => {
                    data.forEach(pin => {
                        const marker = L.marker([pin.lat, pin.lng]).addTo(map);

                        const img = `<img src='${pin.img}' class="popup-image">`;
                        
                        marker.bindPopup(
                            `${img}<br>
                            <b>${pin.title}</b>
                            <br>${pin.scientific}<br>
                            <b>Description:</b> ${pin.description}<br>
                            <b>Medicinal Uses:</b> ${pin.medicinal}<br>
                            <i>${pin.category}</i>`
                        );

                        markers.push({ title: pin.title.toLowerCase(), marker });
                    });

                    //Switch sa Base layer
                    L.control.layers(
                        { "OpenStreetMap": openStreetMap, "Satellite": satellite },
                        {},
                        { collapsed: false }
                    ).addTo(map);
                });

            document.getElementById("searchBar").addEventListener("keyup", function () {
                const text = this.value.toLowerCase().trim();

                markers.forEach(obj => {
                    if (obj.title.startsWith(text)) {
                        obj.marker.setOpacity(1);
                        obj.marker.openPopup();
                    } else {
                        obj.marker.setOpacity(0);
                    }

                });
            });
        }

        document.addEventListener("DOMContentLoaded", function () {
            initMap("eco-map.json");
        });

    </script>
</body>

</html>